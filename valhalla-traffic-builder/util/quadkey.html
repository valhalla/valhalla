<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Draw Quadkeys on MapLibre</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <link href="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <script>


    const quadkeys = [
  "0233101",
  "0230112",
  "0302322",
  "0213032",
  "0212122",
  "1202210",
  "0231221",
  "0212133",
  "0320100",
  "0230131",
  "0302212",
  "1202203",
  "0231230",
  "0213210",
  "0231002",
  "1202202",
  "1221031",
  "0231033",
  "0302331",
  "0302200",
  "1202122",
  "0231310",
  "1221003",
  "1221011",
  "0322001",
  "0231300",
  "1203122",
  "0231103",
  "0230121",
  "0213303",
  "0212332",
  "0212113",
  "0320122",
  "0212300",
  "0212132",
  "0213332",
  "0212303",
  "0320103",
  "0320000",
  "0302230",
  "1203020",
  "0320231",
  "0212323",
  "0231302",
  "0303200",
  "0302213",
  "0213223",
  "0320020",
  "0323002",
  "0313331",
  "0302301",
  "0213123",
  "0213333",
  "0231021",
  "1202311",
  "0303202",
  "0320013",
  "1202131",
  "0303220",
  "0231320",
  "1202022",
  "0231223",
  "1202130",
  "0213323",
  "0320031",
  "0231111",
  "0320200",
  "0230111",
  "0230310",
  "0302232",
  "1221012",
  "0231200",
  "0213233",
  "0230123",
  "1202032",
  "0213022",
  "0320002",
  "0212312",
  "0230130",
  "0233130",
  "0231210",
  "0213212",
  "0201210",
  "0230113",
  "0213313",
  "1203323",
  "1202230",
  "0213221",
  "1202313",
  "0320010",
  "0233111",
  "0230331",
  "1203102",
  "0302311",
  "0231100",
  "0320033",
  "0320102",
  "0302302",
  "0231102",
  "1203231",
  "0212311",
  "0230133",
  "0231121",
  "0320201",
  "0320202",
  "0233012",
  "0320001",
  "1203030",
  "0210220",
  "0231120",
  "0231031",
  "1203220",
  "0320011",
  "1202212",
  "0231231",
  "0233011",
  "0212301",
  "0231003",
  "0231131",
  "0213220",
  "0231323",
  "0320021",
  "0302303",
  "0320032",
  "0302333",
  "1203120",
  "0231312",
  "0231222",
  "1202033",
  "0320212",
  "1203322",
  "0231311",
  "0302220",
  "1202312",
  "0231012",
  "0220333",
  "0213023",
  "0213202",
  "0213203",
  "0212322",
  "0212233",
  "0302300",
  "1221101",
  "0320023",
  "0231303",
  "0213122",
  "0231321",
  "0213231",
  "0302321",
  "0213320",
  "0233102",
  "0302221",
  "0233113",
  "1221013",
  "1221102",
  "0212330",
  "1202120",
  "0213201",
  "0213312",
  "0201013",
  "1221100",
  "0231030",
  "0303221",
  "1221112",
  "1202133",
  "0231133",
  "0230313",
  "0320230",
  "1203200",
  "1203201",
  "0212231",
  "1202003",
  "0231023",
  "1203022",
  "0320012",
  "0213033",
  "0231013",
  "0230311",
  "1202132",
  "0313313",
  "0303203",
  "0233112",
  "0213211",
  "0212313",
  "0213322",
  "0320213",
  "1202200",
  "1202103",
  "1202002",
  "0212331",
  "1203021",
  "0302310",
  "0231211",
  "0231020",
  "1203221",
  "1203230",
  "0222111",
  "0231322",
  "0322000",
  "0230102",
  "0230132",
  "0213132",
  "0302210",
  "1202221",
  "0213222",
  "1203023",
  "1202102",
  "1202220",
  "0302223",
  "1203302",
  "0212123",
  "0230120",
  "1202320",
  "0313133",
  "1202331",
  "0231110",
  "1203203",
  "0230011",
  "0302330",
  "1202112",
  "1202213",
  "0302323",
  "0231233",
  "1203223",
  "0231122",
  "1203211",
  "0212310",
  "0302320",
  "1202300",
  "1202113",
  "0231010",
  "0231313",
  "0233010",
  "0231203",
  "0212333",
  "0320101",
  "0320003",
  "0212321",
  "0233100",
  "0213200",
  "1202030",
  "1202020",
  "0320022",
  "0213213",
  "0231032",
  "1221103",
  "0213310",
  "0230110",
  "1202123",
  "1202013",
  "0212213",
  "1203202",
  "0303301",
  "0213311",
  "0320210",
  "1202231",
  "0303023",
  "0231301",
  "0231232",
  "0212211",
  "1221030",
  "0231113",
  "0230101",
  "0213331",
  "0313131",
  "1202321",
  "1202301",
  "0302332",
  "0302313",
  "0213321",
  "0231022",
  "1202330",
  "1221111",
  "1203002",
  "0320120",
  "0231202",
  "0213330",
  "1202023",
  "0313311",
  "0223000",
  "0302312",
  "1202012",
  "0213030",
  "1203032",
  "1203210",
  "0213300",
  "0302203",
  "0233013",
  "0302201",
  "0231101",
  "0213301",
  "0231212",
  "0230103",
  "1203213",
  "0231132",
  "0231123",
  "0212131",
  "1203320",
  "1221001",
  "1221120",
  "0231011",
  "1203332",
  "1203033",
  "0320110",
  "0231201",
  "0233103",
  "0303212",
  "0233121",
  "0302202",
  "0230100",
  "1202021",
  "0231000",
  "1202302",
  "0320030",
  "0231001",
  "1203012",
  "1221110",
  "1203233",
  "1202211",
  "0212320",
  "1202121",
  "1202031",
  "0213302",
  "0231130",
  "1221010",
  "1203031",
  "0302233",
  "1221113",
  "1203232",
  "0223002",
  "0320121",
  "1202201",
  "1203003",
  "1203212",
  "1203300",
  "0302231",
  "1203333",
  "0213230",
  "0231220",
  "0302222",
  "0212302",
  "0231112",
  "0313113",
  "0231213",
  "0320211",
  "1202303",
  "1203013",
  "0213232",
  "0302211",
  "1202310"
]

    // Convert a quadkey to XYZ
    function quadkeyToTile(quadkey) {
      let x = 0, y = 0;
      const z = quadkey.length;
      for (let i = 0; i < z; i++) {
        const bit = z - i;
        const mask = 1 << (bit - 1);
        switch (quadkey[i]) {
          case '1':
            x |= mask;
            break;
          case '2':
            y |= mask;
            break;
          case '3':
            x |= mask;
            y |= mask;
            break;
        }
      }
      return { x, y, z };
    }

    // Convert tile coordinates to lat/lon bounds
    function tileToBounds(x, y, z) {
      const n = Math.pow(2, z);
      const lon_min = x / n * 360.0 - 180.0;
      const lon_max = (x + 1) / n * 360.0 - 180.0;

      const lat_rad_min = Math.atan(Math.sinh(Math.PI * (1 - 2 * y / n)));
      const lat_rad_max = Math.atan(Math.sinh(Math.PI * (1 - 2 * (y + 1) / n)));
      const lat_min = lat_rad_min * (180 / Math.PI);
      const lat_max = lat_rad_max * (180 / Math.PI);

      return [lon_min, lat_min, lon_max, lat_max];
    }

    // Initialize map
    const map = new maplibregl.Map({
      container: 'map',
      // style: 'https://demotiles.maplibre.org/style.json',
      style: 'https://api.radar.io/maps/styles/radar-default-v1?publishableKey=prj_live_pk_21d246b87698c16eb0c034bda8210886cec3ef04',
      center: [-73.9851, 40.7589], // NYC
      zoom: 6
    });

    map.on('load', () => {
      const features = quadkeys.map(qk => {
        const { x, y, z } = quadkeyToTile(qk);
        const [lonMin, latMin, lonMax, latMax] = tileToBounds(x, y, z);

        return {
          type: "Feature",
          geometry: {
            type: "Polygon",
            coordinates: [[
              [lonMin, latMin],
              [lonMax, latMin],
              [lonMax, latMax],
              [lonMin, latMax],
              [lonMin, latMin]
            ]]
          },
          properties: { quadkey: qk, z }
        };
      });

      map.addSource('quadkeys', {
        type: 'geojson',
        data: {
          type: 'FeatureCollection',
          features
        }
      });

      map.addLayer({
        id: 'quadkey-borders',
        type: 'line',
        source: 'quadkeys',
        paint: {
          'line-color': '#FF0000',
          'line-width': 1
        }
      });

      map.addLayer({
        id: 'quadkey-fill',
        type: 'fill',
        source: 'quadkeys',
        paint: {
          'fill-color': '#FF0000',
          'fill-opacity': 0.1
        }
      });

      // Fit map to all quadkeys
      const coords = features.flatMap(f => f.geometry.coordinates[0]);
      const lons = coords.map(c => c[0]);
      const lats = coords.map(c => c[1]);
      const bounds = [
        [Math.min(...lons), Math.min(...lats)],
        [Math.max(...lons), Math.max(...lats)]
      ];
      map.fitBounds(bounds, { padding: 50 });
    });
  </script>
</body>

</html>
