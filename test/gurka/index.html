
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://valhalla.github.io/valhalla/test/gurka/">
      
      
        <link rel="prev" href="../../contributing/">
      
      
        <link rel="next" href="../../locales/">
      
      
      <link rel="icon" href="../../images/valhalla_logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Testing - Valhalla Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#valhalla-gurka-tests" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Valhalla Docs" class="md-header__button md-logo" aria-label="Valhalla Docs" data-md-component="logo">
      
  <img src="../../images/valhalla_logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Valhalla Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Testing
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/valhalla/valhalla/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Valhalla Docs" class="md-nav__button md-logo" aria-label="Valhalla Docs" data-md-component="logo">
      
  <img src="../../images/valhalla_logo.svg" alt="logo">

    </a>
    Valhalla Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/valhalla/valhalla/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../valhalla-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction for Users
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../building/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build from Source
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../terminology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Terminology
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../README_python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python bindings
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../README_nodejs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Node.js bindings
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Public APIs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Public APIs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/protocol-buffers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protocol Buffers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Turn-by-Turn Route API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Turn-by-Turn Route API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/turn-by-turn/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/turn-by-turn/api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimized/api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimized Route API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/matrix/api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Matrix API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/isochrone/api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Isochrone API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/map-matching/api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Map Matching API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/locate/api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Locate API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/elevation/api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Elevation API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/expansion/api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Expansion API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/status/api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Status API
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Internal topics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Internal topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mjolnir/why_tiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why tiles?
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../route_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview of how routes are computed
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../decoding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Decoding shape
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tiles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tile structure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../speeds/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Speed information
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sif/dynamic-costing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dynamic costing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sif/elevation_costing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Elevation influenced bicycle routing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../elevation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Elevation Lookup Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Unit tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tzdb_update/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tzdb update
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Internal components
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Internal components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../baldr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Baldr (routing data strutures/algorithms)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../loki/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Loki (associate locations with graph edges)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../midgard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Midgard (data structures for geography/geometry)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../odin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Odin (route narrative/maneuver generation)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sif/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sif (costing for edges/transitions)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skadi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Skadi (digital elevation model usage)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tyr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tyr (service layer)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_8" >
        
          
          <label class="md-nav__link" for="__nav_9_8" id="__nav_9_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Meili (map matching)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_8">
            <span class="md-nav__icon md-icon"></span>
            Meili (map matching)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../meili/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Meili
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../meili/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../meili/algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../meili/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../meili/implementation_details/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implementation Details
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../meili/library_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Library API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../meili/service_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Service API
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_9" >
        
          
          <label class="md-nav__link" for="__nav_9_9" id="__nav_9_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Mjolnir (routing graph/tile generation)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_9">
            <span class="md-nav__icon md-icon"></span>
            Mjolnir (routing graph/tile generation)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mjolnir/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mjolnir
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mjolnir/geojson/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Map Roulette Geojson Generation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mjolnir/getting_started_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mjolnir: Getting started guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mjolnir/map_roulette/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automatic Map Roulette Task Updates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mjolnir/map_roulette_blog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Map Roulette and Valhalla
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mjolnir/tag_parsing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OSM Tag Usage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mjolnir/historical_traffic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Traffic in Valhalla
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_10" >
        
          
          <label class="md-nav__link" for="__nav_9_10" id="__nav_9_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Thor (routing algorithms)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_10">
            <span class="md-nav__icon md-icon"></span>
            Thor (routing algorithms)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../thor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Thor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../thor/isochrones/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Isochrones
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../thor/path-algorithm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Path algorithm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../incidents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Incidents
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Data sources
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Data sources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mjolnir/data_sources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data sources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mjolnir/admins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Administrative data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mjolnir/attribution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Attribution requirements
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" checked>
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#test-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Test structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-gurka" class="md-nav__link">
    <span class="md-ellipsis">
      Using Gurka
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-and-running" class="md-nav__link">
    <span class="md-ellipsis">
      Building and Running
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-construct-a-map" class="md-nav__link">
    <span class="md-ellipsis">
      How to construct a map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-a-generated-map" class="md-nav__link">
    <span class="md-ellipsis">
      Using a generated map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assertions" class="md-nav__link">
    <span class="md-ellipsis">
      Assertions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Assertions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gurkaassertraw" class="md-nav__link">
    <span class="md-ellipsis">
      gurka::assert::raw
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gurkaassertosrm" class="md-nav__link">
    <span class="md-ellipsis">
      gurka::assert::osrm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utility-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Utility functions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-help" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging help
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../locales/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Locales
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/valhalla/valhalla/blob/master/CHANGELOG.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../releasing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Releasing a new Valhalla version
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#test-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Test structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-gurka" class="md-nav__link">
    <span class="md-ellipsis">
      Using Gurka
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-and-running" class="md-nav__link">
    <span class="md-ellipsis">
      Building and Running
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-construct-a-map" class="md-nav__link">
    <span class="md-ellipsis">
      How to construct a map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-a-generated-map" class="md-nav__link">
    <span class="md-ellipsis">
      Using a generated map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assertions" class="md-nav__link">
    <span class="md-ellipsis">
      Assertions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Assertions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gurkaassertraw" class="md-nav__link">
    <span class="md-ellipsis">
      gurka::assert::raw
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gurkaassertosrm" class="md-nav__link">
    <span class="md-ellipsis">
      gurka::assert::osrm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utility-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Utility functions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-help" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging help
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="valhalla-gurka-tests">Valhalla Gurka Tests<a class="headerlink" href="#valhalla-gurka-tests" title="Permanent link">&para;</a></h1>
<p>Test in <code>test/gurka/</code> directory are "integration" level tests.  They check the full pipeline from
map parsing through to route / match / etc result generation.</p>
<h2 id="test-structure">Test structure<a class="headerlink" href="#test-structure" title="Permanent link">&para;</a></h2>
<p>Inside the <code>test/gurka/</code> directory, every file called <code>test_*.cc</code> is built as a distinct executable.</p>
<p>A file called <code>test/gurka/test_turns.cc</code> will end up as <code>build/test/gurka/gurka_turns</code>.</p>
<h2 id="using-gurka">Using Gurka<a class="headerlink" href="#using-gurka" title="Permanent link">&para;</a></h2>
<p>The <code>gurka.h</code> header provides helper functions for generating small test maps from ASCII art,
building tiles from them, executing Valhalla API requests against those tiles, and helpers
for checking parts of the API response for expected results.</p>
<p>To create a new test:</p>
<ol>
<li>Create a file <code>test/gurka/test_&lt;your-test-name&gt;.cc</code>.</li>
<li>Populate a test case.</li>
</ol>
<p>A minimal example test looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gtest/gtest.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gurka.h&quot;</span>

<span class="n">TEST</span><span class="p">(</span><span class="n">TestSuite</span><span class="p">,</span><span class="w"> </span><span class="n">TestName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ascii_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sa">R</span><span class="s">&quot;</span><span class="dl">(</span>
<span class="s">        A----B----C</span>
<span class="s">    </span><span class="dl">)</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">gurka</span><span class="o">::</span><span class="n">ways</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span><span class="s">&quot;ABC&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{{</span><span class="s">&quot;highway&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;primary&quot;</span><span class="p">}}}};</span>

<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gurka</span><span class="o">::</span><span class="n">buildtiles</span><span class="p">(</span><span class="n">ascii_map</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">ways</span><span class="p">,</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="s">&quot;test/data/example&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gurka</span><span class="o">::</span><span class="n">route</span><span class="p">(</span><span class="n">map</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;auto&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">directions</span><span class="p">().</span><span class="n">routes_size</span><span class="p">(),</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">directions</span><span class="p">().</span><span class="n">routes</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">legs_size</span><span class="p">(),</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some tests need the timezone db to be loaded. To build timezone db initially, you can run <code>make -j$(nproc) gurka_time_tracking</code>.</p>
</div>
<h2 id="building-and-running">Building and Running<a class="headerlink" href="#building-and-running" title="Permanent link">&para;</a></h2>
<p>After timezone exists in your <code>build/test/data</code> directory, you can:</p>
<ul>
<li>
<p>Run tests <em>individually</em> by running <code>make run-gurka_example</code> or by running something like this:</p>
<div class="highlight"><pre><span></span><code>./test/gurka/gurka_conditional_restrictions<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--gtest_filter<span class="o">=</span>ConditionalRestrictions.NoRestrictionAuto
</code></pre></div>
</li>
<li>
<p>Build and execute <em>all</em> integration tests with <code>make run-gurka</code>.</p>
</li>
</ul>
<h2 id="how-to-construct-a-map">How to construct a map<a class="headerlink" href="#how-to-construct-a-map" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Check out <a href="https://wiki.openstreetmap.org/wiki/Beginners_Guide_1.3">Beginner's guide on OpenStreetMap Wiki</a> to understand OSM data format.</p>
</blockquote>
<p>You need 4 things to build a test map.</p>
<p><strong>Step 1</strong>. Define the positions of <a href="https://wiki.openstreetmap.org/wiki/Node">OSM nodes</a> on the map by drawing an ASCII representation.</p>
<p>The map is interpreted as a 2D grid (see <code>gridsize</code> below). The letters <code>A-Za-z0-9</code> represent the nodes. Only node positions are interpreted from the ASCII grid, but you can use any other character to help give context (i.e. use <code>----</code> to indicate that two nodes will be connected by a way).</p>
<p>Using C++ <a href="https://en.cppreference.com/w/cpp/language/string_literal">Raw String Literals (6)</a> is an easy way to to draw multilinestring maps.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">ascii_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sa">R</span><span class="s">&quot;</span><span class="dl">(</span>
<span class="s">    A---B---C     j</span>
<span class="s">        |        /</span>
<span class="s">    D---E---f---h</span>
<span class="dl">)</span><span class="s">&quot;</span><span class="p">;</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only the <em>position</em> of the <code>A-Za-z0-9</code> characters matter - other characters are <em>ignored</em> and are just helpful for describing your intent.</p>
</div>
<p><strong>Step 2</strong>. Define how the nodes are connected together as <a href="https://wiki.openstreetmap.org/wiki/Way">OSM ways</a>.</p>
<p>You need to build a <code>gurka::ways</code> object to represent the ways and relevant tags. This object has a <code>std::string</code> key which defines a sequence of nodes that are connected, then a <code>std::vector</code> of key/value pairs that describe the tags to go on a way. C++ initializer list syntax allows for a fairly compact expression of a list of ways and their tags.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="n">gurka</span><span class="o">::</span><span class="n">ways</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;ABC&quot;</span><span class="p">,</span><span class="w">   </span><span class="c1">// String referencing nodes to be connected in order</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;highway&quot;</span><span class="p">,</span><span class="s">&quot;motorway&quot;</span><span class="p">},</span><span class="w">  </span><span class="c1">// key/value tags to be put on the way</span>
<span class="w">        </span><span class="p">{</span><span class="s">&quot;access&quot;</span><span class="p">,</span><span class="s">&quot;none&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="s">&quot;Test Road&quot;</span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;BE&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;highway&quot;</span><span class="p">,</span><span class="s">&quot;motorway&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="s">&quot;access&quot;</span><span class="p">,</span><span class="s">&quot;none&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="s">&quot;Test Connector&quot;</span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">};</span>
</code></pre></div>
<p><strong>Step 3</strong>. Define <a href="https://wiki.openstreetmap.org/wiki/Tags">OSM tags</a> on the nodes, if any.</p>
<p>Here, you need a <code>gurka::nodes</code> object. Construction is identical to the <code>gurka::ways</code> object, except that the primary key should just be a single character (not a <code>char</code>, but a 1-character <code>std::string</code>).</p>
<div class="highlight"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="n">gurka</span><span class="o">::</span><span class="n">nodes</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w">   </span><span class="c1">// String referencing nodes to be connected in order</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;barrier&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;block&quot;</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// key/value tags to put on the node</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">};</span>
</code></pre></div>
<p><strong>Step 4</strong>. Define a list of <a href="https://wiki.openstreetmap.org/wiki/Relation">OSM relations</a>.</p>
<p>A common example is a <a href="https://wiki.openstreetmap.org/wiki/Relation:restriction">restriction relation</a>, which restricts possible maneuvers. You need to build a <code>gurka::relation</code> object. Construction here is a little more complex, but C++ initializer list syntax still works (get used to lots of <code>{}</code>).</p>
<div class="highlight"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="n">gurka</span><span class="o">::</span><span class="n">relations</span><span class="w"> </span><span class="n">relations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="c1">// List of the members on the relation</span>
<span class="w">            </span><span class="n">gurka</span><span class="o">::</span><span class="n">relation_member</span><span class="p">{</span><span class="n">gurka</span><span class="o">::</span><span class="n">way_member</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;kh&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;from&quot;</span><span class="p">},</span>
<span class="w">            </span><span class="n">gurka</span><span class="o">::</span><span class="n">relation_member</span><span class="p">{</span><span class="n">gurka</span><span class="o">::</span><span class="n">way_member</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;il&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;to&quot;</span><span class="p">},</span>
<span class="w">            </span><span class="n">gurka</span><span class="o">::</span><span class="n">relation_member</span><span class="p">{</span><span class="n">gurka</span><span class="o">::</span><span class="n">way_member</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hi&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;via&quot;</span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="c1">// List of the key/value tags on the relation</span>
<span class="w">            </span><span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;restriction&quot;</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="s">&quot;restriction&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;no_right_turn&quot;</span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">};</span>
</code></pre></div>
<p>Once you have all these elements, you can now use them to build an OSM PBF file, and generate tiles for it, using:</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gurka</span><span class="o">::</span><span class="n">buildtiles</span><span class="p">(</span><span class="n">ascii_map</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">ways</span><span class="p">,</span><span class="w"> </span><span class="n">nodes</span><span class="p">,</span><span class="w"> </span><span class="n">relations</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test/data/example&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The <code>map.pbf</code> and tiles will be written to <code>test/data/example</code>. The value <code>100</code> is the size of the grid to be used. It's in <em>meters</em>, and decides the distance between the nodes in the ASCII map.</p>
<p>The returned <code>map</code> object has two properties:</p>
<ul>
<li><code>config</code> - the <code>boost::property_tree</code> that was used to generate the tiles.</li>
<li><code>nodes</code> - an <code>std::unordered_map</code>, where keys are nodes, and values are corresponding <code>PointLL</code> coordinates on a generated map.</li>
</ul>
<h2 id="using-a-generated-map">Using a generated map<a class="headerlink" href="#using-a-generated-map" title="Permanent link">&para;</a></h2>
<p>Once you have map tiles, you can use them in tests. Gurka provides helpers to make it easy to perform some normal interactions.</p>
<div class="highlight"><pre><span></span><code><span class="n">valhalla</span><span class="o">::</span><span class="n">Api</span>
<span class="nf">route</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">gurka</span><span class="o">::</span><span class="n">map</span><span class="o">&amp;</span><span class="w"> </span><span class="n">map</span><span class="p">,</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">waypoints</span><span class="p">,</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">costing</span><span class="p">);</span>
</code></pre></div>
<p>This performs a route request on the map. You can use named waypoints that you've drawn
on the map as positions to route between.</p>
<div class="highlight"><pre><span></span><code><span class="n">valhalla</span><span class="o">::</span><span class="n">Api</span>
<span class="nf">match</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">gurka</span><span class="o">::</span><span class="n">map</span><span class="o">&amp;</span><span class="w"> </span><span class="n">map</span><span class="p">,</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">waypoints</span><span class="p">,</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">break_at_waypoints</span><span class="p">,</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">costing</span><span class="p">);</span>
</code></pre></div>
<p>This performs a trace request with the waypoints provided. You can toggle the <code>type: break</code>
parameter by setting <code>break_at_waypoints</code>.</p>
<h2 id="assertions">Assertions<a class="headerlink" href="#assertions" title="Permanent link">&para;</a></h2>
<p>Gurka provides helper functions to make it easy to test various aspects of an API response.</p>
<h3 id="gurkaassertraw"><code>gurka::assert::raw</code><a class="headerlink" href="#gurkaassertraw" title="Permanent link">&para;</a></h3>
<p>By default, <code>gurka::route</code> and <code>gurka::match</code> functions return a <code>valhalla::Api</code> object, which is the raw Protocol Buffers object that Valhalla passes around. You can check some things directly on this with the helpers in the <code>gurka::assert::raw</code> namespace.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// namespace gurka::assert::raw</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">expect_maneuvers</span><span class="p">(</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">valhalla</span><span class="o">::</span><span class="n">Api</span><span class="o">&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">valhalla</span><span class="o">::</span><span class="n">DirectionsLeg_Maneuver_Type</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">expected_maneuvers</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">expect_maneuver_begin_path_indexes</span><span class="p">(</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">valhalla</span><span class="o">::</span><span class="n">Api</span><span class="o">&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">expected_indexes</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">expect_instructions_at_maneuver_index</span><span class="p">(</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">valhalla</span><span class="o">::</span><span class="n">Api</span><span class="o">&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">,</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">maneuver_index</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">expected_text_instruction</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">expected_verbal_transition_alert_instruction</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">expected_verbal_pre_transition_instruction</span><span class="p">,</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">expected_verbal_post_transition_instruction</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">expect_path_length</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">valhalla</span><span class="o">::</span><span class="n">Api</span><span class="o">&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">expected_length_km</span><span class="p">,</span>
<span class="w">                        </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">error_margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">expect_path</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">valhalla</span><span class="o">::</span><span class="n">Api</span><span class="o">&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">,</span>
<span class="w">                 </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">expected_names</span><span class="p">);</span>
</code></pre></div>
<h3 id="gurkaassertosrm"><code>gurka::assert::osrm</code><a class="headerlink" href="#gurkaassertosrm" title="Permanent link">&para;</a></h3>
<p>Valhalla can also return responses in OSRM-compatible format. To test that results contain things you
expect when serialized to OSRM form, you can use the helpers in the <code>gurka::assert::osrm</code> namespace.
These functions will first serialize the raw <code>valhalla::Api</code> object into a JSON document
(using <code>tyr::serializeDirections</code>), then perform assertions within the JSON document only.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// namespace gurka::assert::osrm</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">expect_steps</span><span class="p">(</span><span class="n">valhalla</span><span class="o">::</span><span class="n">Api</span><span class="o">&amp;</span><span class="w"> </span><span class="n">raw_result</span><span class="p">,</span>
<span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">expected_names</span><span class="p">,</span>
<span class="w">                  </span><span class="kt">bool</span><span class="w"> </span><span class="n">dedupe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">expect_match</span><span class="p">(</span><span class="n">valhalla</span><span class="o">::</span><span class="n">Api</span><span class="o">&amp;</span><span class="w"> </span><span class="n">raw_result</span><span class="p">,</span>
<span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">expected_names</span><span class="p">,</span>
<span class="w">                  </span><span class="kt">bool</span><span class="w"> </span><span class="n">dedupe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
</code></pre></div>
<h2 id="utility-functions">Utility functions<a class="headerlink" href="#utility-functions" title="Permanent link">&para;</a></h2>
<p>The main purpose of Gurka is to write high-level, end-to-end tests on minimaps. There are some
low-level helper functions available in case you want to do something a little more custom:</p>
<ul>
<li><code>gurka::detail::build_config(workdir)</code> - builds a <code>boost::property_tree</code> for tile generation in <code>workdir</code>.</li>
<li><code>gurka::detail::map_to_coordinates(ascii_map, gridsize)</code> - calculates coordinates for all the <code>A-Za-z0-9</code> nodes in the <code>ascii_map</code> given the <code>gridsize</code>.</li>
<li><code>gurka::detail::build_pbf(node_locations, ways, nodes, relations, pbf_filename)</code> - generates an OSM PBF for the nodes, ways, and relations you've defined. The <code>nodemap</code> is the result of <code>gurka::detail::map_to_coordinates</code>.</li>
</ul>
<h2 id="debugging-help">Debugging help<a class="headerlink" href="#debugging-help" title="Permanent link">&para;</a></h2>
<p>You can print your gurka map and visually inspect it at <a href="https://geojson.io/">geojson.io</a> by dumping out the GeoJSON via <code>dump_geojson_graph</code> function:</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gurka</span><span class="o">::</span><span class="n">do_action</span><span class="p">(</span><span class="n">valhalla</span><span class="o">::</span><span class="n">Options</span><span class="o">::</span><span class="n">route</span><span class="p">,</span><span class="w"> </span><span class="n">map</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;3&quot;</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;auto&quot;</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">gurka</span><span class="o">::</span><span class="n">dump_geojson_graph</span><span class="p">(</span><span class="n">map</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</code></pre></div>
<p>The graph expansion can be visually inspected with the <a href="https://valhalla.github.io/demos/expansion/">expansion demo</a> by calling the expansion action. Copy the GeoJSON into the expansion demo and move the slider via the arrow keys.</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gurka</span><span class="o">::</span><span class="n">do_action</span><span class="p">(</span>
<span class="w">    </span><span class="n">valhalla</span><span class="o">::</span><span class="n">Options</span><span class="o">::</span><span class="n">expansion</span><span class="p">,</span><span class="w"> </span><span class="n">map</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;3&quot;</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;auto&quot;</span><span class="p">);</span>
</code></pre></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.tabs.link", "navigation.instant", "navigation.sections", "navigation.top", "toc.follow", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>