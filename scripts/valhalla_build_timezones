#!/bin/sh

error_exit() {
  echo "Error: $1" 1>&2
}

if [ ! -f ./timezones-with-oceans.shapefile.zip ]; then
  error_exit 'Timezone polygon file "timezones-with-oceans.shapefile.zip" is not found'
else
  unzip ./timezones-with-oceans.shapefile.zip 1>&2 || error_exit "unzip failed"
fi

tz_file=$(mktemp)
spatialite_tool -i -shp "./combined-shapefile-with-oceans" -d "${tz_file}" -t tz_world -s 4326 -g geom -c UTF-8 1>&2 || error_exit "spatialite_tool import failed"
spatialite ${tz_file} "SELECT CreateSpatialIndex('tz_world', 'geom');" 1>&2 || error_exit "SpatialIndex failed"
spatialite ${tz_file} "VACUUM;" 1>&2 || error_exit "VACUUM failed"
spatialite ${tz_file} "ANALYZE;" 1>&2 || error_exit "ANALYZE failed"

rm -rf /data/combined-shapefile-with-oceans* /data/alias_tz.csv

cat ${tz_file}
