#!/bin/sh

if  ! which spatialite >/dev/null; then
  echo "Error: spatialite not found which is required. Please install via: apt-get install spatialite-bin"
fi

if  ! which unzip >/dev/null; then
  echo "Error: unzip not found which is required. Please install via: apt-get install unzip"
fi

unzip /data/timezones-with-oceans.shapefile.zip

tz_file=$(mktemp)
spatialite_tool -i -shp "./combined-shapefile-with-oceans" -d "${tz_file}" -t tz_world -s 4326 -g geom -c UTF-8
spatialite ${tz_file} "SELECT CreateSpatialIndex('tz_world', 'geom');"
spatialite ${tz_file} "VACUUM;"
spatialite ${tz_file} "ANALYZE;"

rm -rf /data/combined-shapefile-with-oceans* /data/alias_tz.csv
